# 控制语句

1. **【强制】** 在一个 `switch `块内，每个` case `要么通过` break / return `等来终止，要么注释说明程序将继续执行到哪一个` case` 为止 ; 在一个`switch` 块内，都必须包含一个`default`语句并且放在最后，即使它什么代码也没有。

   **<font color='#4ead5b'>正例：</font>**

   ```php
   switch ($expr) {
       case 0:
           echo 'First case, with a break'; 
           break;
       case 1:
           echo 'Second case, which falls through'; // no break
       case 2: case 3: case 4:
           echo 'Third case, return instead of break';
           return; 
       default:
           echo 'Default case';
           break; 
   }
   ```

   

2. **【强制】** 在 `if / else / for / while / do `语句中必须使用大括号，即使只有一行代码，避免使用下面的形式:

   > `if(condition) statements;`

3. **【推荐】** 推荐尽量少用 `else` ，`if - else` 的方式可以改写成:

   ```php
   if (condition) {
       ...
       return obj;
   }
   
   // 接着写 else 的业务逻辑代码;
   ```

   

   **<font color='#937c27'>说明：</font>** 如果非得使用`if()...else if()...else...` 方式表达逻辑，【强制】请勿超过 3 层， 超过请使用状态设计模式。

   **<font color='#4ead5b'>正例：</font>** 逻辑上超过 3 层的 `if-else` 代码可以使用卫语句，或者状态模式来实现。

4. **【推荐】** 除常用方法(如 `getXxx/isXxx`)等外，不要在条件判断中执行其它复杂的语句，将复杂逻辑判断的结果赋值给一个有意义的布尔变量名，以提高可读性。

   **<font color='#937c27'>说明：</font>** 很多 if 语句内的逻辑相当复杂，阅读者需要分析条件表达式的最终结果，才能明确什么 样的条件执行什么样的语句，那么，如果阅读者分析逻辑表达式错误呢?

   **<font color='#4ead5b'>正例：</font>**

   ```php
   //伪代码如下
   $existed = (fopen(fileName， "w") != null) && (...) || (...);
   if ($existed) {
   ...
   }
   ```

   **<font color='#ec5248'>反例：</font>**

   ```php
   if ((fopen(fileName， "w") != null) && (...) || (...)) {
   ...
   }
   ```

5. **【推荐】** 循环体中的语句要考量性能，以下操作尽量移至循环体外处理，如定义对象、变量、获取数据库连接，进行不必要的` try - catch `操作 ( 这个 `try - catch `是否可以移至循环体外 ) 。

6. **【推荐】** 接口入参保护，这种场景常见的是用于做批量操作的接口。

7. **【参考】** 方法中需要进行参数校验的场景:

   > 1) 调用频次低的方法。
   > 2) 执行时间开销很大的方法，参数校验时间几乎可以忽略不计，但如果因为参数错误导致 中间执行回退，或者错误，那得不偿失。
   > 3) 需要极高稳定性和可用性的方法。
   > 4) 对外提供的开放接口，不管是` RPC / API / HTTP` 接口。
   > 5) 敏感权限入口。

8. **【参考】** 方法中不需要参数校验的场景:

   > 1) 极有可能被循环调用的方法，不建议对参数进行校验。但在方法说明里必须注明外部参数检查要求。 
   >
   > 2) 底层的方法调用频度都比较高，一般不校验。毕竟是像纯净水过滤的最后一道，参数错误不太可能到底层才会暴露问题。 一般 `DAO `层与`Service 层都`在同一个应用中，部署在同一台服务器中，所以 `DAO`的参数校验，可以省略。
   > 3) 被声明成`private` 只会被自己代码所调用的方法，如果能够确定调用方法的代码传入参数已经做过检查或者肯定不会有问题，此时可以不校验参数。

9. **【强制】** 不允许在循环体中处理比较耗时，消耗资源的操作，比如打开文件，查询数据库等。